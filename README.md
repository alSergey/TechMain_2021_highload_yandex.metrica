# Тема проекта - Яндекс Метрика

## 1. Тема и целевая аудитория

### MVP

1. Авторизация/регистрация
2. Регистрация сайта
3. Просмотр метрик сайта
4. Сбок метрик сайта (сырые метрики без отчетов)

### Целевая аудитория

* У Яндекс Метрики 2 целевых аудитории: владельцы сайтов, которые собирают метрику, пользователи этих сайтов.
* Яндекс Метрика установлена на 6.7 % всех сайтов в интернете. [На 2020 в интернете примерно 1.8 млд сайтов](https://sdvv.ru/articles/elektronnaya-kommertsiya/statistika-interneta-2020-sayty-domeny-khosting-trafik/), значит Яндекс Метрика установлена примерно на 120 млн сайтов.
* Будем считать, количество людей в интернете пропорционально количеству сайтов. [На 2020 интернетом пользуются 4.54 млд пользователей](https://sdvv.ru/articles/elektronnaya-kommertsiya/statistika-interneta-2020-sayty-domeny-khosting-trafik/), тогда пользователей Яндекс Метрики - 300 млн. Тогда в месяц аудитория примерно 9 млд.
* Сервисом пользуются по всему миру. В основном используют в Европе и РФ [3 по популярности система веб аналитики в Европе](https://w3techs.com/technologies/details/ta-yandexmetrika)

## 2. Расчет нагрузки

### Продуктовые метрики

1. **Месячная аудитория** - 9 млд
2. **Дневная аудитория** - 300 млн
3. **Средний размер хранилища пользователя** - за пользователя будем считать владельца сайта
    * Профиль - используется профиль Яндекса
        * Моя фотография после загрузки весила 4 кБ. Возьмем средний размер за 10 кБ.
        * В личных данных пользователя хранится имя, фамилия, e-mail, пароль + настройки пользователя. Возьмем примерный размер под личные данные за 1 кБ.

    | Аватар | Личные данные | **Общий объем** |
    | ------ | ------------- | --------------- |
    | 10 кБ  | 1 кБ          | 11 кБ           |

    * Информация о сайте - при создании сайта спрашиваются имя счетчика, адрес сайта, часовой пояс, почта для уведомлений. Будем считать, что информация о сайте занимает 1 кБ.

    * Метрики сайта - будем считать, что метрики сайта - это пользователи и информация о их посещениях. Распишем какая информация у нас есть у пользователя при посещении сайта. Разобьем информацию о пользователя на общие данные пользователя и данные за каждое посещение.

    | Общие данные               | Размер |
    | -------------------------- | ------ |
    | ClienID                    | 5 Б    |
    | Возраст                    | 5 Б    |
    | Пол                        | 5 Б    |
    | Первый визит               | 10 Б   |
    | Последний визит            | 10 Б   |
    | Количество визитов         | 5 Б    |
    | Общее время на сайте       | 10 Б   |
    | Общий размер               | 50 Б   |

    | Данные каждого посещения   | Количество за 1 посещение | Размер |
    | -------------------------- | ------------------------- | ------ |
    | Номер визита               | 1                         | 5 Б    |
    | Время визита               | 1                         | 10 Б   |
    | Время на сайте             | 1                         | 10 Б   |
    | Источник трафика           | 1                         | 5 Б    |
    | Местоположение             | 1                         | 10 Б   |
    | Операционная система       | 1                         | 10 Б   |
    | Браузер                    | 1                         | 5 Б    |
    | IP                         | 1                         | 5 Б    |
    | Тип устройства             | 1                         | 10 Б   |
    | Информация о клике         | 10                        | 50 Б  |
    | Посещенная страница        | 5                         | 25 Б   |
    | Общий размер               |                           | 145 Б  |

    Для удобства будем считать размер пользователя за визит 150 Б. Будем считать, что пользователь заходит на сайт в среднем 10 раз в день, получается размер метрики пользователя за день 4000 Б. Возьмем количество пользователей на сайте за день 10 000.

    **Размер метрик за одни день**

    | Размер пользователя | Размер пользователя за посещение | Количество посещений пользователя | Количество пользователей | Размер |
    | ------------------- | -------------------------------- | --------------------------------- | ------------------------ | ------ |
    | 50 Б                | 150 Б                            | 10                                | 10 000                   | 15 Мб  |

    * Общий размер - профиль + информация о сайте + метрики сайта за день

    **Общий размер пользователя за день**

    | Профиль | Информация о сайте | Метрика | Размер |
    | --------| ------------------ | --------| -------|
    | 11 кБ   | 1 кБ               | 15 мБ   | 15 Мб  |

4. **Среднее количество действий пользователя**
    * Авторизация - если у сайта стоит кука на 1 день, то среднее количество будет 1 запрос в день
    * Регистрация - пользователь регистрируется 1 раз на сайте, поэтому будет 0 запросов в день
    * Регистрация сайта - обычно пользователь регистрирует 1 сайт на учетную запись, поэтому будет 0 запросов в день
    * Просмотр информации о сайте - владельцы маленьких сайтов реже просматривают информацию, владельцы крупных постоянно сидят и изучают метрики. Будем считать, что происходит где-то 10 запросов в день.
    * Сбор метрик
        * Заход на сайт - мы посчитали, что пользователь заходит примерно 10 раз в день, получается 10 запросов в день
        * Нажатие на кнопку - мы посчитали, что во время посещения сайта пользователь нажимает на кнопки примерно 10 раз, получается 100 запросов в день
        * Переход на другую страницу - мы посчитали, что пользователь во время посещения сайта переходит между 10 страницами, получается 50 запросов в день.
        * Уход с сайта - учитывая, что пользователь посещает сайт примерно 10 раз в день, получаем 10 запросов в день

    | Действие                    | Количество запросов |
    | --------------------------- | ------------------- |
    | Авторизация                 | 1                   |
    | Регистрация                 | 0                   |
    | Регистрация на сайте        | 0                   |
    | Просмотр информации о сайте | 10                  |
    | Заход на сайте              | 10                  |
    | Нажатие на кнопку           | 100                 |
    | Переход на другую страницу  | 50                  |
    | Уход с сайта                | 10                  |
    | Общее количество            | 181                 |

### Технические метрики

1. **Размер хранения в разбивке по типам данных**
    * Профиль - у нас 120 млн сайтов, будем считать, что на 1 сайт у нас 1 пользователь. Получаем 1 ТБ
    * Информация о сайте - у нас 120 млн сайтов, получаем 115 ГБ
    * Метрики сайта - у нас 120 млн сайтов, получаем за 1 год 600 ПБ. Яндекс Метрика существует с 2009 года, то есть 12 лет, учитывая, что сайтов раньше было меньше, то будем считать 1800 ПБ за все время

2. Сетевой трафик **Пиковое потребление в теченнии суток**
    * Просмотр информации о сайте - будем считать, что в среднем просматривать информацию будут 10 раз в день. При получении информации о сайте нам отдается не вся информация, а ее сжатые данные. Будем считать, что за раз нам приходит 100 кБ информации.

    | Количество действий пользователя | Размер | Количество сайтов | **Общий объем** |
    | -------------------------------- | ------ | ----------------- | --------------- |
    | 10                               | 100 кБ | 120 млн           | 11 ТБ           |

    * Заход на сайт

    | Количество действий пользователя | Размер | Количество пользователей | **Общий объем** |
    | -------------------------------- | ------ | ------------------------ | --------------- |
    | 10                               | 30 Б   | 300 млн                  | 83 ГБ           |

    * Нажатие на кнопку

    | Количество действий пользователя | Размер | Количество пользователей | **Общий объем** |
    | -------------------------------- | ------ | ------------------------ | --------------- |
    | 100                              | 30 Б   | 300 млн                  | 0.8 ТБ          |

    * Переход на другую страницу

    | Количество действий пользователя | Размер | Количество пользователей | **Общий объем** |
    | -------------------------------- | ------ | ------------------------ | --------------- |
    | 50                               | 30 Б   | 300 млн                  | 0.4 ТБ          |

    * Уход с сайта

    | Количество действий пользователя | Размер | Количество пользователей | **Общий объем** |
    | -------------------------------- | ------ | ------------------------ | --------------- |
    | 10                               | 30 Б   | 300 млн                  | 83 ГБ           |

3. RPS и трафик в секунду

    | Действие                    | Трафик   | RPS     |
    | --------------------------- | -------- | ------- |
    | Просмотр информации о сайте | 133 МБ/C | 13888   |
    | Заход на сайт               | 1 МБ/C   | 34722   |
    | Нажатие на кнопку           | 9 МБ/C   | 347222  |
    | Переход на другую страницу  | 5 МБ/C   | 173611  |
    | Уход с сайта                | 1 МБ/C   | 34722   |
    | **Итог**                    | 163 МБ/C | 604165  |

## 3. Логическая схема

## 4. Физическая схема

## 5. Технологии

## 6. Схема проекта

## 7. Список серверов

## 8. Литература

1. <https://ru.wikipedia.org/wiki/Яндекс.Метрика>
2. <https://sdvv.ru/articles/elektronnaya-kommertsiya/statistika-interneta-2020-sayty-domeny-khosting-trafik/>
3. <https://w3techs.com/technologies/details/ta-yandexmetrika>
